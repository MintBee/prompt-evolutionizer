# Prompt Evolutionizer

새로운 LLM 기반 AI 서비스를 위해서 AI 모델을 고르고, 프롬프트 엔지니어링을 하는 과정은 매우 번거로워질 수 있습니다.

매 프롬프트마다 그 결과가 LLM 모델별로 저장이 되어야 하고, 새로운 모델이 출시되면 과거 사용했던 프롬프트가 현재 사용하고 있는 프롬프트보다 좋아질 수도 있습니다. 

이러한 불편한 점을 해결하기 위해 이 서비스는 한 프로젝트에 대해서 프롬프트들의 변천사를 깃과 비슷한 방식으로 버전 관리 (Version Control) 할 수 있도록 합니다.

각 프롬프트는 따로따로 관리되지만, 각각의 프롬프트는 그 프롬프트가 어디로부터 파생되었는지 추적할 수 있는 부모 프롬프트를 가질 수 있다.

각 프롬프트와, 여러모델의 프롬프트 결과가 저장되있는 프로젝트의 일부분을 프롬프트 커밋이라고 하며, 최종적으로 유저는 각 부모와 자식 프롬프트가 연결된 그래프를 볼 수 있다.

### 프롬프트 커밋 데이터

- 제목 (Default: 등록 일시)
- 프롬프트
- 프롬프트 등록 일시
- 각각 LLM 모델 (사용자가 원하는 모델을 설정 가능) 의
    - 응답
    - 응답 지연 시간 (round trip time)
    - 응답 일시 (UTC datetime)
- 메모 (Optional)

## 용어

- 프로젝트: 하나의 프롬프트를 발전시키기 위한 프로젝트. 메타 데이터로 프로젝트 이름, 프로젝트 생성 시점, 생성자 등을 가지고 있고, 데이터로는 트리 형태의 프롬프트 커밋들을 가지고 있다. 

- 프롬프트 커밋: 유저는 새로운 프롬프트 커밋을 생성해 그 안에서 여러 모델의 프롬프트 결과를 받아볼 수 있다. 한번 생성한 프롬프트 커밋은 수정할 수 없고, 삭제만 가능하다. 만약 부모 프롬프트 커밋이 삭제되면 부모 자식 프롬프트 커밋은 삭제되지 않되, 부모 프롬프트가 없는 상태가 된다. 

## 유저 시나리오

1. 프롬프트 엔지니어링이 필요한 유저는 서비스에 들어가 프로젝트를 생성한다.
    - 프로젝트 생성에는 초기 프롬프트가 필요하며, 사용자는 자신이 원하는 AI모델을 골라 여러번 프롬프트를 날려보며 초기 프롬프트를 정할 수 있다.
    - 초기 프롬프트가 정해지면, 이에 따라 프로젝트 제목이 추천되고 `프로젝트 생성` 을 누르면 프로젝트가 생성된다.
2. 유저 리서치 또는 마켓 리서치를 통해 프롬프트를 개선할 필요성을 느낀 유저는 이전에 생성한 프로젝트에 들어가 처음부터 새로운 프롬프트를 만들거나, 기존 프롬프트를 복사하고 고쳐서 새로운 프롬프트 커밋을 만든다.
    - 이 경우도 초기 프롬프트 생성때와 같이, 원하는 AI모델을 골라 여러번 프롬프트를 날려보며 프롬프트를 정할 수 있다.
3. 많은 프롬프트를 비교할 필요를 느낀 사용자는 여러 프롬프트를 돌아보며 각 프롬프트와 그 결과들을 비교할 수 있다.
4. (추후 개발 예정) 여러가지 프롬프트의 장점만 취하고 싶은 사용자는 여러 프롬프트를 나열해 놓고, 필요한 부분만 뽑아서 프롬프트들을 병합할 수 있다.

## 기능적 요구사항

### FR-01: 사용자 인증 및 권한 관리
- FR-01-01: 시스템은 구글 소셜 로그인을 통한 사용자 인증을 지원해야 한다.
- FR-01-02: 게스트 사용자는 예시 프로젝트를 조회할 수 있어야 한다.
  - 프로젝트 생성, 수정, 삭제 권한은 없음
  - LLM API 호출 권한 없음
- FR-01-03: 인증된 사용자만 프로젝트를 생성하고 관리할 수 있어야 한다.

### FR-02: 프로젝트 관리
- FR-02-01: 사용자는 새로운 프로젝트를 생성할 수 있어야 한다.
  - 초기 프롬프트 입력 필수
  - 선택한 AI 모델에 대해 프롬프트 테스트 가능
  - AI 기반 프로젝트 제목 자동 추천 기능
- FR-02-02: 사용자는 자신의 프로젝트 목록을 조회할 수 있어야 한다.
- FR-02-03: 사용자는 프로젝트를 삭제할 수 있어야 한다.
- FR-02-04: 프로젝트는 다음 메타데이터를 포함해야 한다:
  - 프로젝트 이름
  - 프로젝트 생성 시점 (UTC datetime)
  - 생성자 정보
  - 프로젝트 소유자 및 협업자 목록
- FR-02-05: (추후 구현) 프로젝트 소유자는 다른 사용자를 협업자로 초대할 수 있어야 한다.
  - 모든 프로젝트는 기본적으로 비공개
  - 초대받은 사용자만 프로젝트 접근 가능
  - 협업자는 프롬프트 커밋 생성/조회 권한 보유

### FR-03: 프롬프트 커밋 관리
- FR-03-01: 사용자는 새로운 프롬프트 커밋을 생성할 수 있어야 한다.
  - 처음부터 새로 작성
  - 기존 프롬프트 커밋 복사 후 수정 (부모-자식 관계 형성)
- FR-03-02: 프롬프트 커밋 생성 시 선택한 AI 모델들에 대해 프롬프트를 여러 번 테스트할 수 있어야 한다.
- FR-03-03: 프롬프트 커밋은 다음 데이터를 포함해야 한다:
  - 제목 (기본값: 등록 일시)
  - 프롬프트 내용 (시스템 프롬프트와 사용자 프롬프트 구분 없음)
  - 프롬프트 등록 일시 (UTC datetime)
  - 부모 프롬프트 커밋 ID (선택적)
  - 메모 (선택적)
- FR-03-04: 각 프롬프트 커밋은 선택된 LLM 모델별로 다음 정보를 저장해야 한다:
  - 모델 이름 및 버전
  - 모델 파라미터 (temperature, max_tokens, top_p 등)
  - 응답 내용
  - 응답 지연 시간 (RTT, milliseconds)
  - 응답 일시 (UTC datetime)
  - 사용된 토큰 수 (입력 토큰 + 출력 토큰)
- FR-03-05: 사용자는 프롬프트 커밋을 삭제할 수 있어야 한다.
  - 부모 커밋 삭제 시 자식 커밋은 유지되나 부모 참조가 제거됨
- FR-03-06: 프롬프트 커밋은 생성 후 수정할 수 없어야 한다 (Immutable).
- FR-03-07: 프롬프트 길이 및 응답 길이에 하드 리미트는 없으나, 토큰 사용량으로 간접적으로 제한된다.

### FR-04: AI 모델 설정 및 관리
- FR-04-01: 시스템은 다양한 LLM 모델을 지원해야 한다.
  - GPT 시리즈 (GPT-4, GPT-4-turbo, GPT-3.5-turbo 등)
  - Claude 시리즈 (Claude 3 Opus, Sonnet, Haiku 등)
  - Gemini 시리즈
  - 기타 주요 LLM 모델
- FR-04-02: 사용자는 프로젝트별로 사용할 AI 모델을 선택/설정할 수 있어야 한다.
- FR-04-03: 각 프롬프트 테스트 시 사용할 모델을 동적으로 선택할 수 있어야 한다.
- FR-04-04: 동일한 모델이라도 다른 파라미터 설정으로 별도의 결과를 생성하고 저장할 수 있어야 한다.
- FR-04-05: 사용자는 다음 모델 파라미터를 설정할 수 있어야 한다:
  - temperature
  - max_tokens
  - top_p
  - frequency_penalty
  - presence_penalty
  - 기타 모델별 고유 파라미터
- FR-04-06: LLM API 키는 서비스에서 제공하며, 사용자가 별도로 입력할 필요가 없다.

### FR-05: 프롬프트 비교 및 시각화
- FR-05-01: 사용자는 프로젝트 내 프롬프트 커밋들의 트리 구조를 시각적으로 볼 수 있어야 한다.
  - 부모-자식 관계가 그래프로 표현됨
- FR-05-02: 사용자는 여러 프롬프트 커밋을 선택하여 비교할 수 있어야 한다.
  - 프롬프트 내용 비교
  - 각 모델별 응답 비교
  - 응답 시간 비교
  - 토큰 사용량 비교
  - 모델 파라미터 비교
- FR-05-03: 사용자는 개별 프롬프트 커밋의 상세 정보를 조회할 수 있어야 한다.

### FR-06: 토큰 사용량 관리
- FR-06-01: 시스템은 사용자별 토큰 사용량을 실시간으로 추적해야 한다.
- FR-06-02: 시스템은 모델별로 토큰 사용량 가중치를 적용해야 한다.
  - 고성능 모델(예: GPT-4)은 더 높은 가중치 적용
  - 저성능 모델(예: GPT-3.5)은 더 낮은 가중치 적용
- FR-06-03: 사용자별로 주간(일주일) 토큰 사용 제한을 설정하고 강제해야 한다.
  - 제한 초과 시 LLM API 호출 차단
  - 사용자에게 명확한 에러 메시지 표시
- FR-06-04: 토큰 사용 제한은 매주 월요일 00:00 UTC에 리셋되어야 한다.
- FR-06-05: 사용자는 자신의 토큰 사용 내역을 조회할 수 있어야 한다.
  - 일별/주별/월별 통계
  - 모델별 사용량
  - 프로젝트별 사용량
- FR-06-06: 사용자는 현재 주간 토큰 사용량과 남은 할당량을 확인할 수 있어야 한다.

### FR-07: 예시 프로젝트
- FR-07-01: 시스템은 게스트 사용자가 참고할 수 있는 예시 프로젝트를 제공해야 한다.
- FR-07-02: 예시 프로젝트는 읽기 전용으로 제공되어야 한다.
- FR-07-03: 인증된 사용자는 예시 프로젝트를 자신의 프로젝트로 복사할 수 있어야 한다.

### FR-08: 개인정보 보호
- FR-08-01: 사용자는 서비스 이용 전 개인정보 수집 및 이용 동의를 해야 한다.
- FR-08-02: 사용자는 자신의 프롬프트 데이터를 완전히 삭제할 수 있어야 한다.
- FR-08-03: 사용자 탈퇴 시 모든 개인정보 및 프로젝트 데이터가 삭제되어야 한다.

## 비기능적 요구사항

### NFR-01: 성능
- NFR-01-01: 프롬프트 커밋 조회 응답 시간은 평균 500ms 이하여야 한다.
- NFR-01-02: 프로젝트 트리 시각화 로딩 시간은 2초 이하여야 한다.
- NFR-01-03: LLM API 호출 타임아웃은 30초로 설정한다.

### NFR-02: 확장성
- NFR-02-01: 시스템은 최소 100명의 동시 사용자를 지원해야 한다.
- NFR-02-02: 데이터베이스는 수평적 확장이 가능한 구조여야 한다.
- NFR-02-03: 새로운 LLM 모델 추가 시 기존 코드 수정을 최소화할 수 있어야 한다.

### NFR-03: 가용성
- NFR-03-01: 시스템 가동률(uptime)은 99% 이상이어야 한다.
- NFR-03-02: 외부 LLM API 장애 시에도 기존 데이터 조회 기능은 정상 작동해야 한다.

### NFR-04: 보안
- NFR-04-01: 모든 API 통신은 HTTPS를 통해 암호화되어야 한다.
- NFR-04-02: 구글 OAuth 2.0을 통한 안전한 사용자 인증이 구현되어야 한다.
- NFR-04-03: 세션 관리가 안전하게 구현되어야 한다.
  - JWT 토큰 사용
  - 적절한 토큰 만료 시간 설정
- NFR-04-04: 프롬프트 데이터는 사용자별로 격리되어 저장되어야 한다.
- NFR-04-05: LLM API 키는 암호화되어 안전하게 저장되어야 한다.
  - 환경 변수 또는 시크릿 관리 시스템 사용
  - 클라이언트에 절대 노출되지 않아야 함
- NFR-04-06: SQL Injection, XSS 등 일반적인 웹 보안 취약점에 대한 방어가 구현되어야 한다.
- NFR-04-07: 프로젝트 접근 권한 검증이 모든 API 엔드포인트에서 수행되어야 한다.

### NFR-05: 사용성
- NFR-05-01: UI는 직관적이고 반응형이어야 한다 (모바일/태블릿/데스크톱 지원).
- NFR-05-02: 프롬프트 입력 시 실시간 자동 저장 기능을 제공해야 한다.
- NFR-05-03: 에러 발생 시 사용자에게 명확한 에러 메시지를 제공해야 한다.

### NFR-06: 유지보수성
- NFR-06-01: 코드는 명확한 아키텍처 패턴을 따라야 한다.
- NFR-06-02: API 문서가 자동으로 생성되어야 한다.
- NFR-06-03: 단위 테스트 커버리지는 최소 70% 이상이어야 한다.
- NFR-06-04: 로깅 시스템이 구현되어 디버깅 및 모니터링이 가능해야 한다.

### NFR-07: 데이터 관리
- NFR-07-01: 모든 타임스탬프는 UTC 기준으로 저장되어야 한다.
- NFR-07-02: 데이터베이스는 정기적으로 백업되어야 한다.
- NFR-07-03: 삭제된 데이터는 30일간 복구 가능한 형태로 보관되어야 한다.

### NFR-08: 비용 관리
- NFR-08-01: LLM API 호출 비용이 모니터링 및 추적되어야 한다.
  - 모델별 비용 계산
  - 사용자별 비용 집계
- NFR-08-02: 과도한 API 호출 방지를 위한 Rate Limiting이 구현되어야 한다.
  - 사용자별 분당/시간당 요청 제한
  - 주간 토큰 사용량 제한 강제
- NFR-08-03: 비정상적인 사용 패턴 감지 및 알림 시스템이 구현되어야 한다.


## 위험 식별 및 대처 방안

### R-01: 과도한 토큰 사용 방지

개인이 과하게 토큰을 사용해 너무 많은 비용을 발생시키는 것을 막기 위해 개인별로 토큰 사용 제한을 걸어놓을 필요가 있음. (모델별 토큰 사용량 가중치 부여)

### R-02: 개인정보 수집으로 인해 발생하는 법적 위험

프롬프트 내부에 개인정보가 수집될 수 있기 때문에, 이를 위한 수집 동의 약관 생성 필요
